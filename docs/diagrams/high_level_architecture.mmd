graph TB
    subgraph "OC Fetcher Framework"
        Fetcher[Fetcher<br/>Main Orchestrator]

        subgraph "Bundle Locators"
            FP1[SFTP Directory<br/>Locator]
            FP2[SFTP File<br/>Locator]
            FP3[Generic Directory<br/>Locator]
            FP4[Generic File<br/>Locator]
            FP5[Api Pagination<br/>Locator]
        end

        subgraph "Bundle Loaders"
            DL1[HttpxStreaming<br/>Loader]
            DL2[SFTP<br/>Loader]
            DL3[Api<br/>Loader]
        end

        subgraph "Storage Layer"
            BS1[File Storage]
            BS2[S3 Storage]

            subgraph "Storage Decorators"
                SD1[Unzip Resource<br/>Decorator]

                SD3[Bundle Resources<br/>Decorator]
            end
        end

        subgraph "Supporting Systems"
            PM1[HTTP Manager<br/>Rate Limiting<br/>Scheduling]
            PM2[SFTP Manager<br/>Rate Limiting<br/>Scheduling]
            KV[Key-Value Store<br/>Redis/In-Memory]
            LOG[Structured Logging<br/>Structlog]
            CONFIG[Application Configuration]
        end
    end

    subgraph "External Systems"
        HTTP[HTTP/HTTPS<br/>Endpoints]
        SFTP[SFTP Servers]
        AWS[AWS Services<br/>S3, Secrets Manager]
        REDIS[Redis Cache]
    end

    %% Main flow
    Fetcher --> FP1
    Fetcher --> FP2
    Fetcher --> FP3
    Fetcher --> FP4
    Fetcher --> FP5

    Fetcher --> DL1
    Fetcher --> DL2
    Fetcher --> DL3

    DL1 --> SD1
    DL2 --> SD1
    DL3 --> SD1

    SD1 --> SD3
    SD3 --> BS1
    SD3 --> BS2

    %% External connections
    DL1 --> HTTP
    DL2 --> SFTP
    BS2 --> AWS
    KV --> REDIS

    %% Supporting connections
    Fetcher --> KV
    Fetcher --> LOG
    Fetcher --> CONFIG

    %% Protocol Manager connections (used by both locators and loaders)
    FP1 -.-> PM2
    FP2 -.-> PM2
    FP3 -.-> PM1
    FP4 -.-> PM1
    FP5 -.-> PM1
    DL1 -.-> PM1
    DL2 -.-> PM2
    DL3 -.-> PM1

    style Fetcher fill:#e1f5fe
    style FP1 fill:#f3e5f5
    style FP2 fill:#f3e5f5
    style FP3 fill:#f3e5f5
    style DL1 fill:#e8f5e8
    style DL2 fill:#e8f5e8
    style BS1 fill:#fff3e0
    style BS2 fill:#fff3e0
    style KV fill:#fce4ec
    style LOG fill:#fce4ec
